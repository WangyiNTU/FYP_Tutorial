# **Vision‐based Defect Detection and Anomaly Event Detection Tutorial**

### For vision‐based defect detection and anomaly event detection, there are several Python packages and libraries you can use. Here are some commonly used ones, along with a short tutorial to get started.

## **1 Deep Learning-Pytorch**
### There are several official guidelines and resources provided by reputable organizations and institutions that can help you understand Pytorch. Here are some recommended resources:
### **[1.1 Python Basics](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section00_python_basics>)**
### **[1.2 Machine Learning Basics](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section01_numpy_ml>)**
### **[1.3 Pytorch Intro and Basics](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section02_pytorch_basics>)**
### **[1.4 Multi-Layer Perceptron for Classification](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section03_pytorch_mlp>)**
### **[1.5 Convolutional Neural Networks](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section04_pytorch_cnn>)**
### **[1.6 Pytorch Tools and Training Techniques](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section06_pretraining_augmentations>)**
### **[1.7 Techniques for Detection and Segmentation](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section08_detection>)**
### **[1.8 Attention](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section13_attention>)**
### **[1.9 Transformer](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section14_transformers>)**
### **[1.10 Deploying Models](<https://github.com/LukeDitria/pytorch_tutorials/tree/main/section15_deploying_models>)**

##  **2 Vision‐based Defect Detection and Anomaly Event Detection** 
Anomaly means a deviation from a rule or from what is regarded as standard, regular, or expected. The occurrence of anomalies is often challenging to predict, and the baneful influence is difficult to estimate without distinguishing them. An anomaly can be a minor defect in an industrial product, an unusual object in a driving scene, or an exceptional action in a video. The vision‐based defect detection and anomaly event detection is an important research topic, especially in the field of computer vision.
### **2.1 Define the Problem**
   **2.1.1 Defect Detection**: A defect means some inconsistent result with expectations that affects performance (not a forgery), which could some flaw rather than the exclusion of noise. Defect detection includes both target level and scenario level, target level e.g. surface defect detection, material defect detection etc. Examples of scenario-level defect detection are Small Obstacle Discovery, Fault Discovery, etc. Common methods based on deep learning include the following:

   - **Segmentation-Based**.  Transforms the input defect image into a pixel-wise prediction mask based on semantic segmentation.

   - **Object Detection**. Detect specific texture features in images to find defects.

   - **Generative Adversarial Network**. GAN models can generate defect image samples to improve the detection accuracy of defect detection models.

   **2.1.2 Anomaly Event Detection**: Anomaly detection refers to the detection of anomalous events that occur in a scene. Anomalies persist continuously in space and time, so anomalous event detection is basically based on video or multimodal. Event-level anomaly detection is often used to find potential dangers in surveillance video, or sensitive elements in multimodal content, etc. Common methods include Context-Dependent Analysis, Pose Clustering, Frame Consistency Analysis, Teacher-student, Reconstruction, and so on. Depending on the training paradigm, these methods can be classified as supervised, weakly supervised and unsupervised. 

   
### **2.2 Datasets**
**2.2.1 Defect Dataset**: 
- **[DAGM 2007](<https://hci.iwr.uni-heidelberg.de/node/3616>)**: DAGM 2007 is a synthetic dataset for defect detection on textured surfaces. It contains several categories of image data generated by the defect model.
- **[MVTec AD](<https://www.mvtec.com/company/research/datasets/mvtec-ad>)**: MVTec AD is a dataset for benchmarking anomaly detection methods with a focus on industrial inspection. It contains over 5000 high-resolution images divided into fifteen different object and texture categories. Each category comprises a set of defect-free training images and a test set of images with various kinds of defects as well as images without defects.
- **[AITEX](<https://www.kaggle.com/datasets/nexuswho/aitex-fabric-image-database>)**: This dataset consists of 245 4096x256 pixel images with seven different fabric structures. There are 140 non-defect images in the dataset, 20 of each type of fabric. In addition, there are 105 images of different types of fabric defects (12 types) common in the textile industry.
- More datasets for defect identification are at the following [link](https://github.com/Charmve/Surface-Defect-Detection).

**2.2.2 Video Anomaly Event Dataset**:
- **[UCSD](<http://www.svcl.ucsd.edu/projects/anomaly/dataset.html>)**: The UCSD Anomaly Detection Dataset was a video dataset about the circulation of non pedestrian entities in the walkways and anomalous pedestrian motion patterns. It contains 50 training video samples and 48 testing video samples.
- **[ADOC](<http://qil.uh.edu/main/datasets/>)**: ADOC is an anomaly event dataset consisting of pedestrian videos captured by a single camera on campus. It contains 875 anomalous events.
- **[UBnormal](<https://github.com/lilygeorgescu/UBnormal>)**: UBnormal is a new supervised open-set benchmark composed of multiple virtual scenes for video anomaly detection. It introduces abnormal events annotated at the pixel level at training time, for the first time enabling the use of fully-supervised learning methods for abnormal event detection.
- **[ShanghaiTech](<https://svip-lab.github.io/dataset/campus_dataset.html>)**: Shanghaitech dataset contains a variety of anomalous event datasets in three broad categories: campus, pedestrian, and subway. Further it introduces the anomalies caused by sudden motion such as chasing and brawling in our dataset.
- **[UCF-Crime](<https://aimagelab.ing.unimore.it/imagelab/page.asp?IdPage=30>)**: UCF-Crime dataset strives for the detection of real-world anomalies such as burglaries and assaults in surveillance videos.

### **2.3 Preprocessing**
- **Data Amplification and Generation**
The most commonly used defect image expansion method is to use multiple image processing operations such as mirroring, rotation, translation, distortion, filtering, and contrast adjustment on the original defect samples to obtain more samples. Another more common method is data synthesis, where individual defects are often fused and superimposed on normal (non-defective) samples to form defective samples.

- **Extract Video Features** 
Video feature extraction refers to extracting useful information from video data for further analysis and processing. The extracted information includes spatial features (RGB color space, texture features, edge features) and temporal features (flow).

### **3 Model Selection (Need to Choose One to Reproduce)**
 **3.1 Surface Defect Detection**
- [Explainable Deep One-Class Classification](<https://github.com/liznerski/fcdd>)

 **3.2 Anomaly Event Detection**
- [Anomaly Detection in Video via Self-Supervised and Multi-Task Learning](<https://github.com/whduddhks/Anomaly-Detection-in-Video-via-Self-Supervised-and-Multi-Task-Learning/tree/main>)


### **4 Model Training**
**4.1 Frameworks**

Use frameworks like TensorFlow or PyTorch to build and train your models.

**4.2 Loss Functions** 

Choose appropriate loss functions for deepfake detection tasks (e.g., cross-entropy loss for classification, mean squared error).

**4.3 Training Process** 

Split your dataset into training, validation, and test sets. Train your model using the training set and validate it using the validation set.

### **5 Evaluation**
**For defect detection**
- Precision and Recall
- AUC
- PR-AUC
- Score Gap
- False Alarm Rate on Normal with 0.5 as threshold (Weakly supervised, proposed in CVPR 18)

### **6 Implemention**
**6.1 Getting Started**

- You can choose any one topic to start with, [Surface Defect Detection](<https://github.com/liznerski/fcdd>) or [Anomaly Event Detection](<https://github.com/whduddhks/Anomaly-Detection-in-Video-via-Self-Supervised-and-Multi-Task-Learning/tree/main>)
.

**6.2 Environment** 

- Create a new conda environment and install dependencies.
- Sometimes you may encounter errors, package conflicts, and other issues. Please be patient and use Google to search for solutions.
  
**6.3 Data Preparation**
  
- Choose one dataset to train network.
- The second option is to build a training set that is uniquely tailored to you.
  
**6.4 Training**
- Run the following script (an example) to train your model from scratch.
```python
 python train.py
```
-  If you don't want to train your network from scratch, you can download pre-trained model checkpoints.
**6.5 Evaluation** 
- Run the following script (an example) to evaluate your model.
```python
 python evalate.py
```
**6.6 Testing**
- Run the following script (an example) to test your model.
```python
 python test.py
```

### **7 Deployment**
- Can be deployed in real-time applications (such as anti-fraud platforms), paying attention to optimizing program processing speed.

### **8 Reference**
- Explainable Deep One-Class Classification
- Paper: [https://openreview.net/forum?id=A5VV3UyIQz](https://openreview.net/forum?id=A5VV3UyIQz)
- Anomaly-Detection-in-Video-via-Self-Supervised-and-Multi-Task-Learning
- Paper: [https://arxiv.org/pdf/2011.07491](https://arxiv.org/pdf/2011.07491)
